/* Merged stylesheet: combines brand palette, layout, HUD, grid, drops, and overlays. */

/* Brand colors and variables */
:root{
  --cw-yellow: #FFC907;
  --cw-blue: #2E9DF7;
  --cw-light-blue: #8BD1CB;
  --cw-green: #4FCB53;
  --cw-orange: #FF902A;
  --cw-red: #F5402C;
  --cw-dark-green: #159A48;
  --cw-dark: #073b4c;
  --bg: #f7fbfd;
  --bad: #6b4f3f; /* dirty water */

  /* Accessible design tokens (keeps charity: water palette) */
  --focus-ring: rgba(255,201,7,0.24);   /* yellow focus ring */
  --elevation-1: 0 6px 18px rgba(2,6,23,0.08);
  --radius-lg: 12px;

  /* add a couple of responsive token fallbacks */
  --hero-title-size: clamp(22px, 5vw, 40px);
  --cell-min: 110px; /* base min cell size */
}

*{ box-sizing:border-box; }

body{
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  margin:0;
  padding:30px;
  background: linear-gradient(180deg, var(--bg) 0%, #eaf6ff 100%);
  color:var(--cw-dark);
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
}

/* Page container (kept from earlier layout) */
.container {
  max-width: 980px;
  margin: 50px auto;
  background-color: #fff;
  padding: 24px;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.06);
}

/* Header / branding */
.site-header{
  display:flex;
  align-items:center;
  gap:1rem;
  width:100%;
  justify-content: center;
  max-width:980px;
  box-sizing: border-box;
  padding: 0 8px;
}
.logo{ height:56px; width:auto; display:block; flex-shrink:0; }
.title-block h1{ margin:0; font-size:1.5rem; color:var(--cw-dark); }
.tagline{ margin:0; color:#06638b; font-size:0.95rem; }

/* Make the original header visible inside the hero and style it for the yellow banner */
.banner-hero .site-header .logo {
  height: 48px;
  width: auto;
  display: block;
}

/* Make the title and tagline readable on the yellow hero */
.banner-hero .title-block h1 {
  margin: 0;
  font-size: 1.2rem;
  color: #072b3a; /* choose dark for contrast against yellow */
  font-weight: 800;
}
.banner-hero .title-block .tagline {
  margin: 0;
  color: rgba(7,43,58,0.9);
  font-size: 0.95rem;
}

/* Basic headings */
h1 { text-align:center; font-size:30px; font-weight:bold; color:var(--cw-blue); margin:0 0 8px 0; }

/* HUD and controls */
.game-wrap{ width:100%; max-width:980px; margin-top:1rem; }
.hud{ display:flex; gap:1rem; align-items:center; justify-content:space-between; width:100%; }
.score, .timer{
  background:#fff; padding:0.6rem 0.9rem; border-radius:8px; box-shadow:0 2px 6px rgba(3,3,3,0.07);
  font-weight:600;
}
.start-btn, button{
  background: linear-gradient(180deg, var(--cw-yellow), #f4c542);
  border: none; padding:0.6rem 1rem; border-radius:10px; font-weight:600; cursor:pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  color: #072b3a;
}
.start-btn:hover, button:hover{ filter:brightness(0.98); }

/* small HUD controls (reset + difficulty select) */
.hud select#difficultySelect {
  font-weight:700;
  color: var(--cw-dark);
  background: #fff;
  border-radius:8px;
  border:1px solid rgba(7,43,58,0.06);
  padding:6px 8px;
}
.hud button#resetBtn { padding:8px 12px; font-weight:800; }

/* Game field (drop area) */
.game-field{
  position:relative;
  height:60vh;
  min-height:360px;
  margin-top:1rem;

  /* increased padding so the playable area has breathing room */
  padding: 24px;
  display: flex;
  align-items: center;       /* center grid vertically */
  justify-content: center;   /* center grid horizontally */

  background: linear-gradient(180deg, rgba(46,157,247,0.04), rgba(46,157,247,0.01));
  border-radius:12px;
  overflow:hidden;
  border: 2px solid rgba(46,157,247,0.08);
}

/* Game grid / legacy grid cells (from previous version) */
.game-grid {
  width: min(680px, 96%);
  display: grid;
  /* fixed 3 columns on larger screens; each column has a sensible minimum */
  grid-template-columns: repeat(3, minmax(140px, 1fr));
  gap: clamp(8px, 1.6vw, 16px);
  margin: 6px auto;
}

/* medium screens (tablets / small laptops) -> 2 columns */
@media (max-width: 800px) {
  .game-grid {
    grid-template-columns: repeat(2, minmax(120px, 1fr));
  }
}

/* phones / very narrow screens -> 1 column */
@media (max-width: 420px) {
  .game-grid {
    grid-template-columns: 1fr;
    gap: 10px;
  }
}

/* Make grid cells responsive in height and touch-friendly */
.grid-cell{
  position: relative;
  overflow: visible; /* allow wrappers to pop outside slightly */
  min-height: clamp(88px, 20vh, 160px);
  padding: 8px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  outline: 1px solid rgba(2,6,23,0.04);
  box-shadow: 0 4px 10px rgba(2,8,20,0.04);
  cursor:pointer;
  transition:background-color 0.3s;

  /* Make grid cells easier to tap: increase min-height and center content */
  min-height: 128px;
  padding: 6px;            /* breathing room */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Ensure grid cells are positioned for absolute wrappers (already set, keep) */
.grid-cell { position: relative; overflow: hidden; }

/* Centered pop wrapper: start below the card and animate to exact center */
.grid-cell .water-can-wrapper{
  position: absolute;
  left: 50%;
  top: 50%;
  /* start off below the visible area and slightly scaled down */
  transform: translate(-50%, 110%) scale(0.75);
  transition: transform 220ms cubic-bezier(.2,.9,.2,1), opacity 160ms ease;
  pointer-events: none; /* clicks go to the .water-can */
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  z-index: 20;
}

/* When popped, center the can inside the card */
.grid-cell.pop .water-can-wrapper{
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
}

/* ensure the inline SVG jerry-can fills its container and keeps shape */
.grid-cell .water-can svg {
  width: 100%;
  height: 100%;
  display: block;
}

/* make the can look more like a jerry can (box with handle) — keep slight rounding */
.grid-cell .water-can {
  width: clamp(44px, 9vw, 64px);
  height: clamp(44px, 9vw, 64px);
  display: block;
  margin: 0 auto;
  pointer-events: auto;
  transform-origin: center;
  border-radius: 6px; /* subtle rounding */
  background-color: var(--cw-yellow);
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  box-shadow: 0 6px 14px rgba(7,45,60,0.12);
  border: 2px solid rgba(0,0,0,0.06);
  transition: transform 120ms ease, filter 140ms ease, opacity 120ms ease;
  z-index: 30;
  opacity: 1;

  /* Can visuals: smoother pop and subtle shadow boost when active */
  transition: transform 220ms cubic-bezier(.2,.9,.2,1), box-shadow 180ms ease, opacity 160ms ease;
  transform-origin: center;
  will-change: transform, opacity;
}
.grid-cell.pop .water-can {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 10px 26px rgba(2,6,23,0.12);
}

/* Dirty / obstacle can: use its own background image and match sizing/placement of normal cans */
.grid-cell .water-can.obstacle {
  background-image: url('img/dirty-can.png');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  box-shadow: 0 6px 14px rgba(7,45,60,0.18);
  border: 2px solid rgba(0,0,0,0.10);
  filter: none;

  /* Obstacle (dirty) can differentiation: subtle red accent ring */
  box-shadow: 0 8px 18px rgba(245,64,44,0.10);
  border: 2px solid rgba(245,64,44,0.12);
}

/* If the dirty image is not present, createCan inserts an inline SVG — ensure it fills the container */
.grid-cell .water-can svg { width: 100%; height: 100%; display: block; }

/* Drops (falling items) */
.drop, .bad-drop{
  position:absolute; top:-60px;
  width:44px; height:60px; border-radius:50% 50% 45% 45%;
  background:var(--cw-blue);
  box-shadow: inset -6px -10px 20px rgba(255,255,255,0.12);
  display:flex; justify-content:center; align-items:center; cursor:pointer; user-select:none;
  animation-name:fall; animation-timing-function: linear;
}
.drop::after{
  content:''; position:absolute; width:10px; height:10px; border-radius:50%;
  background:rgba(255,255,255,0.7); right:10px; top:8px; transform:rotate(20deg);
}
.bad-drop{ background:var(--bad); box-shadow: inset -6px -10px 14px rgba(255,255,255,0.05); }
.drop.tap-effect, .bad-drop.tap-effect{ transform:scale(0.85); opacity:0.9; }

@keyframes fall{ to{ transform: translateY(120vh); } }

/* Small branding/attribution note */
.brand-note{ text-align:center; font-size:13px; color:#666; margin-bottom:8px; }

/* Achievement / status messages */
.achievement{
  text-align:center; margin:12px auto; min-height:28px; font-weight:600; color:var(--cw-dark-green);
  font-weight:700;
  color: var(--cw-blue);
  min-height: 28px;
  margin-top: 10px;

  /* Achievement/milestone badge styling */
  display:inline-block;
  background: rgba(46,157,247,0.06);
  color: var(--cw-blue);
  padding: 6px 10px;
  border-radius: 999px;
  font-weight:700;
  box-shadow: none;
  transition: transform 180ms ease, opacity 200ms ease;
}
.achievement.show {
  transform: translateY(-6px);
  opacity: 1;
}

/* Overlay / start + end screens */
.overlay{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.45); z-index:40; }
.overlay .panel, .overlay-content{ background:white; padding:20px 28px; border-radius:10px; text-align:center; min-width:280px; box-shadow:0 8px 30px rgba(0,0,0,0.18); }
.overlay h2, .overlay-content h2{ margin:0 0 8px; color:var(--cw-blue); }
.overlay .lead{ margin-bottom:8px; color:#333; }
.overlay .large{ background:var(--cw-blue); color:#fff; padding:10px 18px; border-radius:8px; border:none; cursor:pointer; }

/* overlay content padding so text/buttons have space */
.overlay .overlay-content, .overlay .panel {
  padding: 24px; /* increased padding */
}

/* Ensure both attribute-based and class-based hiding work
   (some scripts use setAttribute('hidden') and some toggle the 'hidden' class) */
.overlay[hidden] { display: none; }
.overlay.hidden { display: none; }

/* Generic utility used by script toggles */
.hidden { display: none !important; }

/* Progress bar under stats to show goal progress */
.progress{ max-width:500px; height:10px; background:#eaeef6; border-radius:8px; margin:14px auto; overflow:hidden; }
.progress-fill{ height:100%; background: linear-gradient(90deg,var(--cw-blue),var(--cw-light-blue)); width:0%; transition:width 300ms ease; }

/* when progress completes, switch to a green celebration gradient */
.progress.complete .progress-fill {
  background: linear-gradient(90deg, var(--cw-green), #2ecb7a);
  box-shadow: 0 6px 18px rgba(79,203,83,0.12);
  transform-origin: left;
  will-change: transform, box-shadow;
  animation: progress-complete 900ms cubic-bezier(.2,.9,.2,1);
}

/* small visible percent text under the progress bar */
.progress-text {
  text-align: center;
  margin-top: 8px;
  font-size: 13px;
  color: var(--cw-blue);
  font-weight: 700;
}

/* make grid cells show a clear focus ring for keyboard users */
.grid-cell:focus-visible {
  outline: 3px solid var(--focus-ring);
  outline-offset: 4px;
  border-radius: 10px;
  box-shadow: 0 8px 20px rgba(2,6,23,0.06);
}

/* subtle animation used when progress completes */
@keyframes progress-complete {
  0% { transform: scaleX(0.98); box-shadow: 0 4px 12px rgba(79,203,83,0.06); }
  50% { transform: scaleX(1.02); box-shadow: 0 12px 30px rgba(79,203,83,0.12); }
  100% { transform: scaleX(1); box-shadow: 0 6px 18px rgba(79,203,83,0.12); }
}

/* Top page banner: centers and pads the image, provides subtle elevation */
.banner-wrapper {
  width: 100%;
  display: flex;
  justify-content: center;
  padding: 18px 12px; /* page padding around banner */
  box-sizing: border-box;
  background: var(--cw-yellow); /* big yellow band like reference */
}

/* when a real banner image exists, it will be visible; fallback sits on top */
.top-banner {
  max-width: 980px;
  width: 100%;
  height: auto;
  max-height: clamp(120px, 22vh, 280px);
  object-fit: cover;
  cursor: pointer; /* indicate the banner is clickable to start the game */
}

/* Fallback hero layout (center column) */
.banner-fallback {
  max-width: 420px;
  width: 100%;
  display:flex;
  align-items:center;
  justify-content:center;
}
.banner-hero {
  width:100%;
  padding: clamp(14px, 4vw, 32px);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:22px;
  text-align:center;
  background: transparent;
}

/* black drop icon in rounded square */
.hero-icon{
  width:84px;
  height:84px;
  border-radius:18px;
  background: #000;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow: 0 8px 18px rgba(2,6,23,0.08);
}
/* drop shape inside the square via svg background for crispness */
.hero-icon::after{
  content: "";
  width:36px;
  height:44px;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23ffffff' d='M12 2s6 5.5 6 9a6 6 0 1 1-12 0c0-3.5 6-9 6-9z'/></svg>");
  background-size: contain;
  background-repeat: no-repeat;
  display:block;
}

/* big stacked white title like reference */
.hero-title{
  margin:0;
  font-weight:800;
  color: #fff;
  font-size: var(--hero-title-size);
  line-height: 0.95;
  letter-spacing: -0.02em;
  text-transform: uppercase;
  text-shadow: 0 4px 12px rgba(2,6,23,0.08);
}

/* blue pill play button */
.banner-play{
  appearance: none;
  -webkit-appearance: none;
  background: linear-gradient(180deg, var(--cw-blue) 0%, #0f86e3 100%);
  color: #fff;
  border: none;
  padding: 14px 40px;
  border-radius: 999px;
  font-weight: 900;
  font-size: 18px;
  cursor: pointer;
  box-shadow: 0 14px 36px rgba(46,157,247,0.20);
}
.banner-play:active{ transform: translateY(1px); }
.banner-play:focus{ outline: 3px solid rgba(255,201,7,0.18); outline-offset: 4px; }

/* keep earlier .site-header spacing so hero and header don't collide */
.site-header { margin-top: 12px; }

/* smaller screens: scale down hero */
@media (max-width:640px){
  .hero-title { font-size: 28px; }
  .hero-icon { width:64px; height:64px; border-radius:12px; }
  .banner-play { padding:12px 28px; font-size:16px; }
}

/* logo SVG fallback rules: show inline SVG when the external image failed to load */
.logo-svg { display: none; }
.logo-broken .logo { display: none; }
.logo-broken .logo-svg { display: block; height:56px; width:auto; }

/* If JS detects missing water-can asset, it adds .use-inline-can to html/documentElement.
   This rule provides an embedded SVG fallback for .water-can background. */
.use-inline-can .water-can {
  /* embedded simple can illustration (colors use brand blue/yellow) */
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect x='12' y='18' width='40' height='30' rx='6' fill='%232E9DF7'/><rect x='18' y='8' width='6' height='10' rx='2' fill='%23FFC907'/><circle cx='44' cy='12' r='6' fill='%23FFC907'/></svg>");
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
}

/* show a black silhouette of the jerry-can image when applied */
.water-can.silhouette {
  /* make the image render as a solid black silhouette while preserving transparency */
  filter: brightness(0) saturate(100%) contrast(120%);
  transition: filter 140ms ease, transform 120ms ease, opacity 120ms ease;
}

/* subtle outline so you can see grid cells during testing */
.grid-cell { outline: none; }

/* confetti canvas overlay */
.confetti-canvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 60;
}

/* Respect user preference for reduced motion */
@media (prefers-reduced-motion: reduce) {
  .start-btn, .banner-play, button, .water-can, .grid-cell .water-can-wrapper,
  .achievement { transition: none !important; animation: none !important; }
  @keyframes score-bump { 0% { transform: none; } }
}

/* Responsive: ensure hero/play scales on small screens */
@media (max-width: 420px) {
  .banner-play { padding: 10px 22px; font-size: 15px; }
  .hero-title { font-size: 22px; }
  .grid-cell { min-height: 96px; }
}

/* score bump animation used by JS hook */
@keyframes score-bump {
  0% { transform: scale(1); }
  50% { transform: scale(1.08); }
  100% { transform: scale(1); }
}
.score.updated {
  animation: score-bump 360ms ease;
}

/* Leaderboard / winner form */
.leaderboard-form {
  display:flex;
  flex-direction:column;
  gap:8px;
  align-items:center;
  margin:12px 0 8px;
}
.leaderboard-form label {
  font-size:0.95rem;
  color:var(--cw-dark);
  font-weight:600;
}
.leaderboard-form input {
  width:100%;
  max-width:320px;
  padding:10px 12px;
  border-radius:8px;
  border:1px solid rgba(7,43,58,0.08);
  font-size:15px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
}
.leaderboard-form .start-btn { padding:8px 18px; font-size:15px; }

/* Leaderboard section */
.leaderboard-section {
  margin-top:12px;
  text-align:left;
  max-width:420px;
}
.leaderboard-section h3{
  margin:0 0 8px; color:var(--cw-blue);
}
.leaderboard-list {
  list-style: decimal;
  margin:0;
  padding-left:1.1em;
  max-height:240px;
  overflow:auto;
}
.leaderboard-list li {
  padding:8px 6px;
  border-bottom:1px solid rgba(2,6,23,0.04);
  display:flex;
  justify-content:space-between;
  gap:12px;
}
.leaderboard-list li .name { font-weight:700; color:var(--cw-dark); }
.leaderboard-list li .score { color:var(--cw-blue); font-weight:800; }

/* Remove duplicate :root declaration found lower in the stylesheet.
   The top-of-file :root already defines variables; keep that single source of truth.
   (No runtime behavior changes; this just avoids accidental redefinition.) */

/* Responsive typography and hero scaling */
.banner-hero {
  padding: clamp(14px, 4vw, 32px);
}

/* hero title scales fluidly */
.hero-title {
  font-size: var(--hero-title-size);
  line-height: 0.95;
}

/* banner image: keep aspect, limit height on small screens */
.top-banner {
  max-width: 980px;
  width: 100%;
  height: auto;
  max-height: clamp(120px, 22vh, 280px);
  object-fit: cover;
  cursor: pointer;
}

/* Make grid responsive: auto-fit columns with a sensible min size */
.game-grid {
  width: min(680px, 96%);
  display: grid;
  /* fixed 3 columns on larger screens; each column has a sensible minimum */
  grid-template-columns: repeat(3, minmax(140px, 1fr));
  gap: clamp(8px, 1.6vw, 16px);
  margin: 6px auto;
}

/* medium screens (tablets / small laptops) -> 2 columns */
@media (max-width: 800px) {
  .game-grid {
    grid-template-columns: repeat(2, minmax(120px, 1fr));
  }
}

/* phones / very narrow screens -> 1 column */
@media (max-width: 420px) {
  .game-grid {
    grid-template-columns: 1fr;
    gap: 10px;
  }
}

/* Make grid cells responsive in height and touch-friendly */
.grid-cell{
  position: relative;
  overflow: visible; /* allow wrappers to pop outside slightly */
  min-height: clamp(88px, 20vh, 160px);
  padding: 8px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  outline: 1px solid rgba(2,6,23,0.04);
  box-shadow: 0 4px 10px rgba(2,8,20,0.04);
  cursor:pointer;
  transition:background-color 0.3s;

  /* Make grid cells easier to tap: increase min-height and center content */
  min-height: 128px;
  padding: 6px;            /* breathing room */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Ensure pop wrapper and cans adapt to smaller cell sizes */
.grid-cell .water-can-wrapper { 
  /* scale down on very small screens */
  transform-origin: center;
}
.grid-cell .water-can {
  width: clamp(44px, 9vw, 64px);
  height: clamp(44px, 9vw, 64px);
}

/* Larger hit targets on touch devices */
@media (hover: none) and (pointer: coarse) {
  .banner-play, .start-btn, button {
    padding: 14px 28px;
    font-size: 16px;
    touch-action: manipulation;
  }
  .grid-cell { min-height: 110px; }
  .grid-cell .water-can { width: 56px; height: 56px; }
}

/* reduce heavy motion on small screens for performance & comfort */
@media (max-width: 420px) {
  .banner-hero { gap: 12px; padding: 12px; }
  .hero-icon { width: 56px; height: 56px; border-radius: 12px; }
  .banner-play { padding: 10px 20px; font-size: 15px; }
  .progress { max-width: 92%; }
  /* reduce transform exaggeration */
  .grid-cell.pop .water-can { transform: translateY(-1px) scale(1.01); }
}

/* ensure HUD wraps gracefully on small screens */
.hud {
  gap: 0.6rem;
  align-items: center;
}
@media (max-width:640px){
  .hud { flex-wrap:wrap; justify-content:center; gap:0.5rem; }
  .score, .timer { flex: 0 1 auto; }
}

/* keep accessibility: focus outlines visible at all sizes */
.banner-play:focus-visible, .start-btn:focus-visible, button:focus-visible {
  outline: 3px solid rgba(255,201,7,0.24);
  outline-offset: 4px;
}